generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         String    @id @default(cuid())
  telegramId String    @unique
  username   String?
  lang       String    @default("en")
  wallets    Wallet[]
  projects   Project[]

  createdAt DateTime @default(now())
}

model Wallet {
  id            String          @id @default(cuid())
  userId        String
  user          User            @relation(fields: [userId], references: [id])
  address       String          @unique
  label         String?
  encryptedPriv String? // AES-256 encrypted private key
  isCreator     Boolean         @default(false) // true if this is the creator wallet
  
  projectWallets ProjectWallet[]
  
  createdAt     DateTime        @default(now())
}

model Token {
  id          String   @id @default(cuid())
  ownerWallet String
  mint        String   @unique
  name        String
  symbol      String
  supply      BigInt
  imageUrl    String?
  pumpfunUrl  String?
  status      String   @default("created")
  createdAt   DateTime @default(now())
}

model EventLog {
  id        String   @id @default(cuid())
  type      String
  userId    String?
  mint      String?
  metadata  Json?
  createdAt DateTime @default(now())
}

model Project {
  id        String @id @default(cuid())
  projectId String @unique @default(cuid()) // unique project identifier
  userId    String
  user      User   @relation(fields: [userId], references: [id])

  // Project Status
  status String @default("DRAFT") // DRAFT | FUNDING | READY | LAUNCHED

  // Token Metadata
  stage       String  @default("NAME") // NAME | SYMBOL | IMAGE | CONFIRM | EDIT_*
  name        String?
  symbol      String?
  imageFileId String?
  description String?
  twitter     String?
  telegram    String?
  website     String?

  // Bundling Configuration
  bundleCount         Int     @default(0) // number of wallets for bundling
  buyAmountPerWallet  Float   @default(0.0) // SOL amount per wallet

  // Token Info (after launch)
  mintAddress String?
  metadataUri String?
  imageUri    String?

  // Relations
  projectWallets ProjectWallet[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ProjectWallet {
  id        String  @id @default(cuid())
  projectId String
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  walletId  String
  wallet    Wallet  @relation(fields: [walletId], references: [id])

  // Bundling info
  buyAmount Float   @default(0.0) // SOL to use for buying
  isFunded  Boolean @default(false)

  createdAt DateTime @default(now())

  @@unique([projectId, walletId])
}
